---
source: metrique-macro/src/aggregate.rs
assertion_line: 396
expression: parsed_file
---
#[metrics]
#[derive(Default)]
pub struct AggregatedApiCall {
    #[metrics(unit = Millisecond, name = "latency_2")]
    latency: <Histogram<
        Duration,
        SortAndMerge,
    > as metrique_aggregation::__macro_plumbing::AggregateValue<Duration>>::Aggregated,
    #[metrics(unit = Byte)]
    response_size: <Counter as metrique_aggregation::__macro_plumbing::AggregateValue<
        usize,
    >>::Aggregated,
    response_value: <MergeOptions<
        LastValueWins,
    > as metrique_aggregation::__macro_plumbing::AggregateValue<
        Option<String>,
    >>::Aggregated,
}
impl metrique_aggregation::__macro_plumbing::Merge for ApiCall {
    type Merged = AggregatedApiCall;
    type MergeConfig = ();
    fn new_merged(_conf: &Self::MergeConfig) -> Self::Merged {
        Self::Merged::default()
    }
    fn merge(accum: &mut Self::Merged, input: Self) {
        accum.latency.add_value(&input.latency);
        accum.response_size.add_value(&input.response_size);
        accum.response_value.add_value(&input.response_value);
    }
}
pub struct ApiCallStrategy;
impl metrique_aggregation::__macro_plumbing::AggregateStrategy for ApiCallStrategy {
    type Source = ApiCall;
    type Key = metrique_aggregation::__macro_plumbing::NoKey;
}
#[metrics]
pub struct ApiCall {
    #[metrics(unit = Millisecond, name = "latency_2")]
    latency: Duration,
    #[metrics(unit = Byte)]
    response_size: usize,
    response_value: Option<String>,
}
